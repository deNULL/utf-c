<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UTF-C Demo Page</title>

  <script src="js/utf-c.js"></script>
  <script src="js/scsu.js"></script>
</head>
<body>
  <textarea oninput="updateText(this.value)"></textarea>
  <div id="samples"></div>
  <span id="stats"></span>
  <div>
    UTF-8 (<span id="stats-utf8"></span>): <span id="result-utf8"></span>
  </div>
  <div>
    UTF-C (<span id="stats-utfc"></span>): <span id="result-utfc"></span>
  </div>
  <div>
    SCSU (<span id="stats-scsu"></span>): <span id="result-scsu"></span>
  </div>
  <div>
    Control: <span id="control"></span>
  </div>

<script>
  function plural(n, s = ['', 's']) {
    if (n == 1) {
      return s[0];
    }
    return s[1];
  }
  function displayBytes(el, bytes) {
    document.getElementById(el).innerHTML = Array.of(...bytes).map(byte => `<span class="byte">${byte < 16 ? '0' : ''}${byte.toString(16).toUpperCase()}</span>`).join('');
  }
  function updateText(str) {
    const encoder = new TextEncoder();
    const utf8 = encoder.encode(str);
    document.getElementById('stats').innerHTML = `${str.length} character${plural(str.length)} (in UCS-2)`;
    document.getElementById('stats-utf8').innerHTML = `${utf8.length} byte${plural(utf8.length)}`;
    displayBytes('result-utf8', utf8);

    const utfc = UTFC.encode(str);
    document.getElementById('stats-utfc').innerHTML = `${utfc.length} byte${plural(utfc.length)}`;
    displayBytes('result-utfc', utfc);
    console.log(Array.of(...utfc).map(byte => String.fromCharCode(byte)).join(''));

    const scsu = SCSU.encode(str);
    document.getElementById('stats-scsu').innerHTML = `${scsu.length} byte${plural(scsu.length)}`;
    displayBytes('result-scsu', scsu);
    //console.log(Array.of(...utfc).map(byte => String.fromCharCode(byte)).join(''));

    document.getElementById('control').textContent = UTFC.decode(utfc);

    const hist = {};
    for (let ch of str) {
      const cp = ch.codePointAt(0);
      console.log(ch, cp.toString(16));
      if (!(cp in hist)) {
        hist[cp] = 0;
      }
      hist[cp]++;
    }
    for (let cp in hist) {
      console.log(parseInt(cp).toString(16) + ': ' + hist[cp]);
    }
  }
</script>
</body>
</html>